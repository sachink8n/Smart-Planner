{% extends 'core/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9 col-lg-7">
        <h1 class="text-center mb-4 main-title"><i class="fas fa-brain" style="color: var(--accent-color);"></i> Create AI Plan</h1>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-danger" role="alert" style="background-color: #4a1313; color: #e8a2a2; border-color: #7a2b2b; font-weight: 500;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <div class="form-card">
            <form method="POST" action="{% url 'create_study_plan' %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="subject" class="form-label text-secondary">Topic / Subject</label>
                    <input type="text" class="form-control form-control-dark" id="subject" name="subject" placeholder="e.g., Data Structures, Goa Trip" required>
                </div>
                <div class="mb-3">
                    <label for="goal" class="form-label text-secondary">What is your main goal?</label>
                    <textarea class="form-control form-control-dark" id="goal" name="goal" rows="3" placeholder="e.g., Understand Stacks, Plan 5-day itinerary" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="duration_select" class="form-label text-secondary">Duration (Days)</label>
                    <select class="form-select form-control-dark" id="duration_select">
                        <option value="3">3 Days</option>
                        <option value="5">5 Days</option>
                        <option value="7" selected>7 Days</option>
                        <option value="10">10 Days</option>
                        <option value="14">14 Days</option>
                        <option value="custom">Custom...</option>
                    </select>
                </div>

                <div class="mb-4" id="custom_duration_div" style="display: none;">
                    <label for="custom_duration_days" class="form-label text-secondary">Enter Custom Days:</label>
                    <input type="number" class="form-control form-control-dark" id="custom_duration_days" min="1" max="90" value="7">
                </div>
                
                <input type="hidden" name="duration_days" id="duration_days_hidden_input" value="7">
                <button type="submit" class="btn btn-accent w-100">Generate Plan</button>
            </form>
        </div>
         <div class="text-center mt-3">
            <a href="{% url 'personal_dashboard' %}" class="text-secondary">Cancel</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const durationSelect = document.getElementById('duration_select');
        const customDurationDiv = document.getElementById('custom_duration_div');
        const customDurationInput = document.getElementById('custom_duration_days');
        const hiddenInput = document.getElementById('duration_days_hidden_input');

        durationSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                customDurationDiv.style.display = 'block';
                hiddenInput.value = customDurationInput.value;
            } else {
                customDurationDiv.style.display = 'none';
                hiddenInput.value = this.value;
            }
        });

        customDurationInput.addEventListener('input', function() {
            if (durationSelect.value === 'custom') {
                hiddenInput.value = this.value;
            }
        });
    });
</script>
{% endblock %}